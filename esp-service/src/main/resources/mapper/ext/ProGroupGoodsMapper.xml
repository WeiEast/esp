<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >   
<mapper namespace="com.apass.esp.mapper.ProGroupGoodsMapper" >

    <select id="selectLatestByGoodsId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from t_esp_pro_group_goods
        where goods_id = #{goodsId} and status = 'S' order by id desc limit 1
    </select>
    
    <select id="selectGoodsByGroupId" resultMap="BaseResultMap">
       select
        <include refid="Base_Column_List" />
        from t_esp_pro_group_goods
        where group_id = #{groupId}
    </select>
	<select id="selectByGoodsIdAndActivityId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from t_esp_pro_group_goods
        where goods_id = #{goodsId} and activity_id = #{activityId} and status = 'S'
    </select>
	<!-- 通过goodsId查询成功管理活动的商品信息 -->
	<select id="selectByGoodsId" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from t_esp_pro_group_goods
		where status = 'S'
		AND goods_id = #{goodsId}
	</select>
	<select id="getProGroupGoodsListPage" parameterType="com.apass.esp.domain.query.ProGroupGoodsQuery"
		resultType="com.apass.esp.domain.vo.ProGroupGoodsVo">
				SELECT
						a.goods_code         goodsCode,
						a.sku_id             skuId,
						a.goods_id           goodsId,
						b.goods_name         goodsName,
						b.status             goodsStatus,
						d.category_name      goodsCategory,
			            c.goods_cost_price   goodsCostPrice,
			            c.goods_price        goodsPrice,
			            a.market_price       marketPrice,
			            a.activity_price     activityPrice,
			            a.detail_desc        detailDesc
				FROM
						t_esp_pro_group_goods   a
			LEFT JOIN 	t_esp_goods_base_info   b ON a.goods_id = b.id
			LEFT JOIN   t_esp_goods_stock_info  c ON c.goods_id =b.id
			LEFT JOIN   t_esp_category          d ON b.category_id3 =d.id
	    <include refid="QueryConditionSql" />
        <![CDATA[ 
         order by a.update_date desc
         ]]>
		<if test="startRecordIndex != null">
			<include refid="PAGINATION.MYSQL_PAGINATION" />
		</if>
	</select>
	<select id="getProGroupGoodsListPageCount" parameterType="com.apass.esp.domain.query.ProGroupGoodsQuery"
		resultType="java.lang.Integer">
				SELECT  count(*)
				FROM
						t_esp_pro_group_goods   a
			LEFT JOIN 	t_esp_goods_base_info   b ON a.goods_id = b.id
			LEFT JOIN   t_esp_goods_stock_info  c ON c.goods_id =b.id
			LEFT JOIN   t_esp_category          d ON b.category_id3 =d.id
		<include refid="QueryConditionSql" />
	</select>
    <!-- 查询条件 -->
	<sql id="QueryConditionSql">
		<where>
			<if test="goodsCode != null and goodsCode != ''">
				AND a.goods_code = #{goodsCode, jdbcType=VARCHAR}
			</if>
			<if test="skuId != null and skuId != ''">
				AND a.sku_id = #{skuId, jdbcType=VARCHAR}
			</if>
			<if test="goodsId != null and goodsId != ''">
				AND a.goods_id = #{goodsId, jdbcType=BIGINT}
			</if>
			<if test="categoryId1 != null and categoryId1 != ''">
				AND b.category_id1 = #{categoryId1, jdbcType=BIGINT}
			</if>
			<if test="categoryId2 != null and categoryId2 != ''">
				AND b.category_id2 = #{categoryId2, jdbcType=BIGINT}
			</if>
			<if test="categoryId3 != null and categoryId3 != ''">
				AND b.category_id3 = #{categoryId3, jdbcType=BIGINT}
			</if>
		</where>
	</sql>
</mapper>

